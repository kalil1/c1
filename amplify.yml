version: 1
frontend:
  phases:
    preBuild:
      commands:
        - gem install bundler
        - sudo apt install libpq-dev
        - sudo yum install postgresql-devel
        - sudo zypper in postgresql-devel
        - sudo pacman -S postgresql-libs
        - bundle install
        - yarn install
        - rails db:seed
    build:
      commands:
        - RAILS_ENV=production bundle exec rails assets:precompile
        - RAILS_ENV=production bundle exec rails db:migrate
  artifacts:
    baseDirectory: public
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
      - vendor/bundle/**/*
      - tmp/cache/**/*

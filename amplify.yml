version: 1
frontend:
  phases:
    preBuild:
      commands:
        - gem install bundler
        - rm -f Gemfile.lock
        - sudo apt-get update && sudo apt-get install -y build-essential
        - sudo apt-get update && sudo apt-get install ruby-dev
        - sudo apt-get install libpq-dev
        - bundle install
        - yarn install
        - rails db:seed
    build:
      commands:
        - RAILS_ENV=production bundle exec rails assets:precompile
        - RAILS_ENV=production bundle exec rails db:migrate
  artifacts:
    baseDirectory: public
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
      - vendor/bundle/**/*
      - tmp/cache/**/*

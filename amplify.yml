version: 1
frontend:
  phases:
    preBuild:
      commands:
        - gem install bundler
        - rm -f Gemfile.lock
        - sudo yum install postgresql-devel python3-devel
        - pip install wheel
        - pip install psycopg2
        - sudo amazon-linux-extras install postgresql10
        - sudo yum install libpq-dev
        - bundle install
        - yarn install
        - rails db:seed
    build:
      commands:
        - RAILS_ENV=production bundle exec rails assets:precompile
        - RAILS_ENV=production bundle exec rails db:migrate
  artifacts:
    baseDirectory: public
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
      - vendor/bundle/**/*
      - tmp/cache/**/*
